// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ✅ Tu tabla de usuarios corregida
model users {
  id            String   @id @default(uuid())
  email         String   @unique
  username      String?
  password_hash String?  // Puede ser opcional si usan Google Auth
  is_verified   Boolean  @default(false)
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  // Relaciones con los datos de la app
  planes    Plan[]
  reviews   Review[]
  chats     ChatSession[]
}

// Modelo para los Planes de viaje
model Plan {
  id          String   @id @default(uuid())
  
  // Relación con tu tabla users
  userId      String
  user        users    @relation(fields: [userId], references: [id])
  
  destinoId   String   // ID del destino (ej: "cusco")
  tourNombre  String
  precio      Float
  estado      String   // "borrador", "pendiente", "confirmado", etc.
  
  fechaInicio DateTime?
  fechaFin    DateTime?
  
  gastos      Json?    // Guardamos el objeto de gastos aquí
  resena_completada Boolean @default(false)
  
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
}

// Modelo para Reseñas
model Review {
  id          String   @id @default(uuid())
  
  // Relación con tu tabla users
  userId      String
  user        users    @relation(fields: [userId], references: [id])
  
  planId      String?  // Opcional, para saber de qué plan vino
  destinoId   String
  estrellas   Int
  comentario  String   @db.Text
  
  created_at  DateTime @default(now())
}

// Modelo para Historial de Chat
model ChatSession {
  id          String    @id @default(uuid())
  userId      String
  user        users     @relation(fields: [userId], references: [id])
  
  mensajes    Message[]
  created_at  DateTime  @default(now())
}

model Message {
  id        String      @id @default(uuid())
  chatId    String
  chat      ChatSession @relation(fields: [chatId], references: [id])
  
  rol       String      // "user" o "assistant"
  texto     String      @db.Text
  timestamp DateTime    @default(now())
}

// Modelo Destino (si lo usas en BD, si no, puedes ignorarlo)
model Destino {
  id           String   @id
  slug         String   @unique
  nombre       String
  ubicacion    String
  tipo         String
  precio       Float
  duracion     String
  presupuesto  String
  imagen       String
  descripcion  String   @db.Text
  gastos       Json
  tours        Json
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt
}
