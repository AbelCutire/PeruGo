"use client";

import React, { useState, useRef, useEffect } from "react";
import { useRouter, usePathname } from "next/navigation";
import Link from "next/link";
import { getCurrentUser, logout, isAuthenticated } from "@/services/auth";
import "./Header.css";
import useVoiceSearch from "./funciones/VoiceSearch";

export default function Header({
  isLogged = true,
  onLogout = () => {},
}) {
  const [menuOpen, setMenuOpen] = useState(false);
  const [isDarkMode, setIsDarkMode] = useState(false);
  const [effectiveLogged, setEffectiveLogged] = useState(false);
  const [user, setUser] = useState(null);
  const menuRef = useRef(null);
  const router = useRouter();
  const pathname = usePathname();
  const [menuMovilAbierto, setMenuMovilAbierto] = useState(false);

  const { record, text, toggleRecord } = useVoiceSearch();

  // Verificar sesión al montar
  useEffect(() => {
    const checkSession = () => {
      // Intentar recuperar del servicio o sessionStorage
      const currentUser = getCurrentUser();
      const sessionFlag = typeof window !== "undefined" ? sessionStorage.getItem("isLoggedIn") === "true" : false;
      const logged = isAuthenticated() || sessionFlag;
      
      setEffectiveLogged(logged);
      if (currentUser) setUser(currentUser);
    };

    checkSession();
    // Escuchar cambios en storage por si se loguea en otra pestaña/componente
    window.addEventListener('storage', checkSession);
    return () => window.removeEventListener('storage', checkSession);
  }, []);

  // Detecta cuando se deja de hablar en búsqueda por voz
  useEffect(() => {
    if (!record && text && text.trim()) {
      window.dispatchEvent(new CustomEvent("chatMessage", { detail: { text } }));
    }
  }, [record, text]);

  // Cierra el menú al hacer clic fuera
  useEffect(() => {
    const onDocClick = (e) => {
      if (menuRef.current && !menuRef.current.contains(e.target)) {
        setMenuOpen(false);
      }
    };
    document.addEventListener("mousedown", onDocClick);
    return () => document.removeEventListener("mousedown", onDocClick);
  }, []);

  // Modo oscuro
  useEffect(() => {
    if (isDarkMode) {
      document.body.classList.add("dark-mode");
    } else {
      document.body.classList.remove("dark-mode");
    }
    return () => document.body.classList.remove("dark-mode");
  }, [isDarkMode]);

  const userData = user
    ? {
        nombre: user.username || user.name || (user.email ? user.email.split("@")[0] : "Viajero"),
        correo: user.email || "",
      }
    : {
        nombre: "Invitado",
        correo: "",
      };

  const handleLogout = () => {
    setMenuOpen(false);
    logout();
    setEffectiveLogged(false);
    setUser(null);
    onLogout?.();
    router.push("/");
  };

  const toggleMode = () => setIsDarkMode((prev) => !prev);

  // Helper para saber si un enlace está activo
  const isActive = (path) => pathname === path;

  return (
    <header className="header-fijo header-amplio">
      <div className="header-contenido header-contenido-amplio">
        
        {/* LOGO (Enlace al inicio) */}
        <Link href="/" className="logo-header" style={{ cursor: "pointer", textDecoration: "none" }}>
          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="34px" height="42px">
          <path d="M0 0 C1.22565674 0.29753174 1.22565674 0.29753174 2.47607422 0.60107422 C42.18693543 10.39439432 78.28680334 37.02933385 99.5 72.04296875 C101.79437682 75.96367903 103.93020686 79.95689574 106 84 C106.31807617 84.61697754 106.63615234 85.23395508 106.96386719 85.86962891 C126.32933837 123.9429142 128.92280849 168.09298481 116.14794922 208.70898438 C102.25069187 250.03206902 73.364525 285.03714227 45.0859375 317.44921875 C42.17105804 320.7936116 39.29693277 324.17066023 36.4375 327.5625 C31.16429373 333.81558959 25.84488344 340.02812193 20.51611328 346.23388672 C18.00899015 349.15442275 15.50462672 352.07732311 13 355 C12.00001341 356.16667816 11.0000134 357.33334482 10 358.5 C9.2575 359.36625 9.2575 359.36625 8.5 360.25 C4 365.5 4 365.5 2.49975586 367.25024414 C1.50051604 368.41605104 0.50132977 369.58190386 -0.49780273 370.74780273 C-3.00899461 373.67800398 -5.52113393 376.60738291 -8.03515625 379.53515625 C-8.53571533 380.11845703 -9.03627441 380.70175781 -9.55200195 381.30273438 C-10.55384989 382.46991071 -11.55628543 383.63658295 -12.55932617 384.80273438 C-15.04849743 387.70166088 -17.51757173 390.61442062 -19.953125 393.55859375 C-31.98996933 408.08624069 -31.98996933 408.08624069 -38.5 410.0625 C-43.2045617 409.97848997 -47.03061746 408.76353784 -50.54394531 405.61743164 C-52.05773738 403.95945675 -53.47460764 402.2547312 -54.875 400.5 C-55.39255859 399.87416016 -55.91011719 399.24832031 -56.44335938 398.60351562 C-57.97528822 396.7458862 -59.48924033 394.87485993 -61 393 C-62.49972866 391.16644469 -63.99970293 389.33309024 -65.5 387.5 C-66.21027344 386.62472656 -66.92054688 385.74945313 -67.65234375 384.84765625 C-70.40947646 381.50331391 -73.23142062 378.21922843 -76.0625 374.9375 C-79.42940351 371.03398805 -82.74776967 367.11359211 -85.9375 363.0625 C-89.8503799 358.10618546 -93.99117331 353.36420404 -98.14331055 348.60888672 C-101.4146109 344.85437468 -104.61796461 341.06003413 -107.75 337.1875 C-110.57487839 333.69764112 -113.47717579 330.31989486 -116.5 327 C-120.3685219 322.74998027 -124.0204119 318.36315829 -127.6328125 313.89453125 C-129.6841017 311.38627168 -131.77467328 308.91861567 -133.88745117 306.4621582 C-140.39744812 298.87902074 -146.44905564 290.98152631 -152.47167969 283.00878906 C-153.86441461 281.17821031 -155.27364091 279.36283292 -156.6953125 277.5546875 C-187.4923715 238.34436702 -208.94753246 192.43219434 -203.46484375 141.453125 C-198.85964369 104.48184741 -183.05405375 70.65733141 -157 44 C-156.14019531 43.07832031 -155.28039062 42.15664063 -154.39453125 41.20703125 C-133.20327138 19.01411655 -105.43243765 6.23488748 -76 -1 C-75.30777344 -1.17934082 -74.61554688 -1.35868164 -73.90234375 -1.54345703 C-50.87679594 -7.30556604 -22.8125297 -5.91095746 0 0 Z M-147 54 C-147.86238281 54.84949219 -148.72476563 55.69898438 -149.61328125 56.57421875 C-175.24846987 83.27242954 -189.21798651 120.10984479 -189.25 156.8125 C-189.25067474 157.50563293 -189.25134949 158.19876587 -189.25204468 158.91290283 C-189.23513609 169.85418231 -188.66219833 180.35120667 -186 191 C-185.82839355 191.70189453 -185.65678711 192.40378906 -185.47998047 193.12695312 C-181.35438375 209.51136046 -174.14392609 224.27747387 -166 239 C-164.68 239 -163.36 239 -162 239 C-160.07912223 234.89779438 -158.16337448 230.79320946 -156.25 226.6875 C-155.95888336 226.06341248 -155.66776672 225.43932495 -155.36782837 224.79632568 C-151.54729539 216.59843362 -147.82077835 208.3690304 -144.19921875 200.08105469 C-126.94327647 160.63093857 -126.94327647 160.63093857 -109.75 153.6875 C-106.28045108 153.05141603 -103.27876402 152.93084932 -99.765625 152.95703125 C-98.68571289 152.96323486 -97.60580078 152.96943848 -96.49316406 152.97583008 C-95.25904785 152.98779419 -95.25904785 152.98779419 -94 153 C-93.29037109 151.53530273 -93.29037109 151.53530273 -92.56640625 150.04101562 C-90.77069407 146.33528941 -88.97365821 142.63020628 -87.17626953 138.92529297 C-86.4060649 137.33724549 -85.63619524 135.74903549 -84.86669922 134.16064453 C-56.84994947 76.33260813 -56.84994947 76.33260813 -43.16015625 70.6171875 C-35.38231157 68.39494616 -28.30811782 68.35252498 -21 72 C-16.34525726 74.73713645 -13.82863927 77.21218428 -11.11328125 81.8671875 C-10.77951981 82.43267303 -10.44575836 82.99815857 -10.10188293 83.58078003 C-9.04986128 85.37748181 -8.02149008 87.18578505 -7 89 C-6.66885193 89.58640259 -6.33770386 90.17280518 -5.996521 90.77697754 C-3.35336131 95.47864086 -0.76893231 100.21201959 1.80444336 104.95214844 C2.7675539 106.72311335 3.73719944 108.4905194 4.70703125 110.2578125 C5.2688208 111.2905127 5.83061035 112.32321289 6.40942383 113.38720703 C9.86648391 119.06601854 14.24926036 120.43618715 20.28710938 122.57421875 C27.79099398 125.38348086 32.32896425 129.59191444 35.875 136.8125 C36.37253784 137.78231812 36.37253784 137.78231812 36.88012695 138.77172852 C37.93609528 140.84019435 38.97062982 142.91818176 40 145 C40.52327881 146.05429199 40.52327881 146.05429199 41.05712891 147.12988281 C41.75721916 148.54042065 42.45644823 149.95138627 43.15478516 151.36279297 C44.16834463 153.39901718 45.19821516 155.42632801 46.23046875 157.453125 C48 161 48 161 49.05078125 163.609375 C50.87063305 167.5935773 52.3828149 168.74667264 56.51171875 170.44140625 C59.99782945 171.58813671 63.52772464 172.54682375 67.07617188 173.47949219 C75.42478567 175.73827958 81.47586158 179.41224338 88 185 C89.70356054 186.45761125 91.40772308 187.91448127 93.11401367 189.36889648 C94.27142999 190.3587899 95.42410846 191.35425497 96.5715332 192.35571289 C99.04491294 194.48814397 100.86829052 195.95609684 104 197 C112.00044869 175.0857275 111.52497793 147.42787845 106 125 C105.71793701 123.83476807 105.71793701 123.83476807 105.43017578 122.64599609 C95.89811541 84.64666871 71.34260763 51.34114223 37.97119141 30.74804688 C21.83211397 21.27033609 4.39352335 15.24020037 -14 12 C-14.66032227 11.88285645 -15.32064453 11.76571289 -16.00097656 11.64501953 C-64.05890744 3.52272232 -112.68773086 19.9838208 -147 54 Z M-49 95 C-61.59864156 113.25966304 -70.61800082 134.02269713 -80.03005981 154.03289795 C-80.89787402 155.79288183 -81.88724882 157.49169638 -82.89038086 159.17822266 C-84.29483445 161.98566755 -84.29483445 161.98566755 -83.35009766 165.02392578 C-82.68179932 166.49708252 -82.68179932 166.49708252 -82 168 C-81.59185059 168.92151855 -81.18370117 169.84303711 -80.76318359 170.79248047 C-80.31281738 171.72463379 -79.86245117 172.65678711 -79.3984375 173.6171875 C-78.95677246 174.53612793 -78.51510742 175.45506836 -78.06005859 176.40185547 C-77.50398926 177.54799316 -76.94791992 178.69413086 -76.375 179.875 C-73.714375 185.381875 -73.714375 185.381875 -71 191 C-56.81 191 -42.62 191 -28 191 C-28.82260377 177.59072938 -28.82260377 177.59072938 -30.2265625 164.27734375 C-30.45597014 162.40172217 -30.68513003 160.52607027 -30.9140625 158.65039062 C-31.27063144 155.77339288 -31.63014838 152.89682033 -31.99414062 150.02075195 C-32.35038863 147.19053303 -32.69539535 144.35911388 -33.0390625 141.52734375 C-33.15045563 140.67309311 -33.26184875 139.81884247 -33.37661743 138.93870544 C-33.95766445 134.09190897 -34.09060478 129.8229917 -33 125 C-31 123 -31 123 -28.0625 122.6875 C-25 123 -25 123 -23.36805725 124.1967926 C-21.5923143 126.53736192 -21.39893219 128.25257091 -21.04858398 131.16381836 C-20.84838905 132.74839088 -20.84838905 132.74839088 -20.64414978 134.36497498 C-20.44711205 136.08503502 -20.44711205 136.08503502 -20.24609375 137.83984375 C-20.09970963 139.03114395 -19.9533255 140.22244415 -19.80250549 141.44984436 C-19.33541027 145.27770976 -18.88649111 149.10747341 -18.4375 152.9375 C-18.13199522 155.45261219 -17.82536668 157.96758814 -17.51757812 160.48242188 C-16.94583902 165.19967623 -16.37607864 169.91710832 -15.82202148 174.63647461 C-15.67609558 175.78476242 -15.53016968 176.93305023 -15.37982178 178.11613464 C-15.0919785 181.05947436 -14.94826002 183.86977233 -14.90484619 186.8170929 C-14.56197447 198.39123638 -12.31351628 204.96015111 -3.98312378 213.0818634 C-2.71629952 214.26006572 -1.44846232 215.4371797 -0.1796875 216.61328125 C1.12495167 217.88677094 2.42565493 219.16430382 3.72262573 220.44560242 C7.11688439 223.77743896 10.56191937 227.05131377 14.0211792 230.31542969 C17.52185749 233.6384792 20.96883397 237.01627709 24.421875 240.38867188 C38.18483004 253.8470561 38.18483004 253.8470561 52.50289917 266.70550537 C54.4231306 268.36586734 56.22405164 270.12455271 58 271.9375 C58.5775 272.52402344 59.155 273.11054688 59.75 273.71484375 C60.36875 274.35099609 60.36875 274.35099609 61 275 C64.3415678 271.88934201 66.89654527 268.46103222 69.4140625 264.6796875 C69.82570648 264.06773026 70.23735046 263.45577301 70.66146851 262.82527161 C71.98882706 260.8458962 73.30780975 258.86115437 74.625 256.875 C75.07375488 256.20070953 75.52250977 255.52641907 75.98486328 254.83169556 C82.84120557 244.51202218 89.50869768 234.12607618 95 223 C95.39703125 222.22994629 95.7940625 221.45989258 96.203125 220.66650391 C96.58984375 219.87550293 96.9765625 219.08450195 97.375 218.26953125 C97.73335937 217.54999268 98.09171875 216.8304541 98.4609375 216.08911133 C99.21586389 213.97090874 99.21586389 213.97090874 98.23339844 211.85424805 C95.9272245 208.38722685 92.46742606 206.16957554 89.21484375 203.6328125 C86.99287268 201.87114057 84.9834821 200.02149495 83.00390625 197.9921875 C75.0604676 190.09465751 67.46531264 186.94324569 56.52661133 184.49365234 C48.03316887 182.50164615 42.871589 179.57929978 38.16943359 172.08081055 C36.30300955 168.67993412 34.57161343 165.23854222 32.875 161.75 C31.13637654 158.26889803 29.39482053 154.78934689 27.6472168 151.31274414 C26.57630315 149.15901252 25.53184537 146.99185095 24.51879883 144.81030273 C21.5567658 138.58799038 21.5567658 138.58799038 16.08984375 134.75390625 C14.71816319 134.31574857 13.33284382 133.91817588 11.9375 133.5625 C10.54811747 133.15613464 9.16128873 132.74092119 7.77734375 132.31640625 C7.17140381 132.15599854 6.56546387 131.99559082 5.94116211 131.83032227 C0.76227478 129.61507943 -1.87949649 126.02707315 -4.48828125 121.1953125 C-5.10848145 120.06029297 -5.72868164 118.92527344 -6.36767578 117.75585938 C-6.84482025 116.86483521 -6.84482025 116.86483521 -7.331604 115.95581055 C-8.31990299 114.11118257 -9.32172294 112.27452752 -10.32763672 110.43945312 C-12.69986365 106.10652567 -15.0509532 101.76237292 -17.39306641 97.41308594 C-18.46033875 95.436331 -19.54077123 93.46748124 -20.625 91.5 C-21.17414063 90.4790625 -21.72328125 89.458125 -22.2890625 88.40625 C-24.26068854 85.63336955 -25.93024098 84.43318488 -29 83 C-39.27681952 81.85813116 -43.42378382 87.1728987 -49 95 Z M-116.57348633 175.61376953 C-116.96173584 176.21560059 -117.34998535 176.81743164 -117.75 177.4375 C-118.17627686 178.09089355 -118.60255371 178.74428711 -119.04174805 179.41748047 C-124.57622587 188.16896882 -128.75987247 197.57535961 -133 207 C-133.52029785 208.15000488 -134.0405957 209.30000977 -134.57666016 210.48486328 C-137.37930925 216.68121751 -140.16171557 222.88616757 -142.921875 229.1015625 C-144.79652308 233.32009999 -146.69510766 237.52462786 -148.640625 241.7109375 C-149.02395996 242.54407471 -149.40729492 243.37721191 -149.80224609 244.2355957 C-150.4938775 245.7358094 -151.19410435 247.23210469 -151.90478516 248.72338867 C-153.56122283 252.18116798 -153.56122283 252.18116798 -153.77758789 255.92382812 C-152.80741562 258.51420331 -151.44889109 260.34009807 -149.75390625 262.52734375 C-149.08657471 263.39528564 -148.41924316 264.26322754 -147.73168945 265.1574707 C-147.01585693 266.07488037 -146.30002441 266.99229004 -145.5625 267.9375 C-144.83184326 268.88391357 -144.10118652 269.83032715 -143.34838867 270.80541992 C-141.89169041 272.69157274 -140.43251234 274.57581332 -138.97070312 276.45800781 C-137.36067785 278.5347649 -135.76086565 280.61809149 -134.171875 282.7109375 C-124.37379343 295.59119705 -114.07023251 308.04492741 -103.48388672 320.28222656 C-100.98027636 323.18045008 -98.49089609 326.09085039 -96 329 C-92.98981011 332.51303289 -89.97870971 336.02527635 -86.96484375 339.53515625 C-80.73532354 346.79206069 -74.53726625 354.07441652 -68.36767578 361.38232422 C-66.97540583 363.02908979 -65.57994527 364.67310067 -64.18359375 366.31640625 C-59.06565896 372.34319121 -54.00753687 378.41081802 -49.015625 384.54296875 C-46.39321207 387.73966978 -43.70787294 390.87553122 -41 394 C-32.71127 390.55412348 -26.94726844 380.77777671 -21.44921875 373.984375 C-18.681893 370.61238637 -15.8485306 367.30334554 -13 364 C-9.44532786 359.87544389 -5.9320737 355.72791688 -2.5 351.5 C1.43276102 346.65529439 5.48093163 341.92014357 9.55639648 337.19580078 C12.62017565 333.63594402 15.61589965 330.03321224 18.5625 326.375 C22.66638553 321.31776175 27.02502849 316.5398168 31.4453125 311.76171875 C38.75996689 303.85428656 45.3965098 295.5021429 52 287 C46.94635731 280.89599236 41.45880983 275.31376971 35.8515625 269.71875 C34.87024633 268.73675835 33.88907849 267.75461845 32.90805054 266.77233887 C30.86056685 264.72338901 28.81130689 262.67623737 26.76074219 260.63037109 C24.1530434 258.02836131 21.54985114 255.42189663 18.94799232 252.81404877 C16.92502734 250.78744237 14.89965219 248.76325805 12.87357712 246.73976135 C11.45218553 245.31934682 10.03278178 243.89694395 8.61343384 242.4744873 C4.09986964 237.97707301 -0.46954753 233.6252984 -5.30355835 229.47406006 C-7.46907639 227.59241347 -9.49707601 225.60003385 -11.5078125 223.5546875 C-12.26707031 222.78769531 -13.02632812 222.02070313 -13.80859375 221.23046875 C-14.57300781 220.45316406 -15.33742187 219.67585938 -16.125 218.875 C-17.66679935 217.30746109 -19.21101547 215.74229506 -20.7578125 214.1796875 C-21.4295752 213.49632324 -22.10133789 212.81295898 -22.79345703 212.10888672 C-23.52161621 211.4129541 -24.24977539 210.71702148 -25 210 C-25.84433594 209.09886475 -26.68867188 208.19772949 -27.55859375 207.26928711 C-31.90305365 203.72590007 -36.95773888 204.37914828 -42.3046875 204.51171875 C-43.38380402 204.51879349 -44.46292053 204.52586823 -45.57473755 204.53315735 C-49.00887448 204.56106338 -52.44135894 204.62379831 -55.875 204.6875 C-58.20830973 204.71258761 -60.5416451 204.73539996 -62.875 204.75585938 C-68.58389362 204.81087756 -74.29182873 204.89446684 -80 205 C-80.25974609 204.16122314 -80.51949219 203.32244629 -80.78710938 202.45825195 C-82.09342343 198.73362662 -83.69035582 195.21522438 -85.40625 191.66796875 C-85.73161743 190.99075272 -86.05698486 190.31353668 -86.39221191 189.61579895 C-87.07616443 188.19551483 -87.76202634 186.77614876 -88.44970703 185.35766602 C-89.50363504 183.1799891 -90.54696723 180.99744007 -91.58984375 178.81445312 C-92.25717568 177.43198409 -92.92512264 176.04981172 -93.59375 174.66796875 C-93.90526001 174.0138652 -94.21677002 173.35976166 -94.53771973 172.68583679 C-96.07952699 169.21650622 -96.07952699 169.21650622 -99 167 C-107.21240965 166.31563253 -111.73635629 168.55650242 -116.57348633 175.61376953 Z " fill="currentColor" transform="translate(21,0.75) scale(0.1)"/>
          <path d="M0 0 C0.74357758 -0.01358047 1.48715515 -0.02716095 2.25326538 -0.04115295 C4.70783301 -0.07841022 7.16065338 -0.07848633 9.61547852 -0.07495117 C11.32414939 -0.08594041 13.03281383 -0.09797422 14.74147034 -0.11100769 C18.32181689 -0.13191237 21.90154937 -0.13319495 25.48193359 -0.12207031 C30.06732004 -0.11037705 34.64993663 -0.15789508 39.23481655 -0.22153187 C42.76344671 -0.26214382 46.29140951 -0.26589596 49.82023811 -0.25913048 C51.51036023 -0.26133553 53.20051565 -0.27622074 54.89040947 -0.30408669 C68.05457154 -0.49628157 68.05457154 -0.49628157 71.64961243 2.35345459 C73.00572777 4.44486299 73.81537178 6.3218117 74.55688477 8.69458008 C74.98654541 9.61996582 75.41620605 10.54535156 75.85888672 11.4987793 C76.32234497 12.736521 76.32234497 12.736521 76.79516602 13.99926758 C77.13999023 14.91192383 77.48481445 15.82458008 77.84008789 16.76489258 C78.17975586 17.69043945 78.51942383 18.61598633 78.86938477 19.56958008 C79.22838867 20.51833008 79.58739258 21.46708008 79.95727539 22.44458008 C82.55688477 29.39667829 82.55688477 29.39667829 82.55688477 31.69458008 C83.8775293 31.65977539 83.8775293 31.65977539 85.22485352 31.62426758 C86.38629883 31.6062207 87.54774414 31.58817383 88.74438477 31.56958008 C89.89293945 31.54637695 91.04149414 31.52317383 92.22485352 31.49926758 C97.01761289 31.78020306 99.49757879 32.81024875 103.18188477 35.88598633 C105.84269583 39.03257047 107.11018374 41.78106059 108.55688477 45.63208008 C108.80325684 46.28160645 109.04962891 46.93113281 109.3034668 47.6003418 C109.81273587 48.95175049 110.3154688 50.30563961 110.81176758 51.66186523 C111.54126321 53.65196373 112.29298024 55.63242672 113.04907227 57.61254883 C117.13470533 68.56527702 117.13470533 68.56527702 116.55688477 72.69458008 C115.03040887 74.62292851 114.05104616 75.5628275 111.65510559 76.20162964 C110.94698227 76.25843903 110.23885895 76.31524841 109.50927734 76.3737793 C108.71027008 76.43805115 107.91126282 76.502323 107.08804321 76.56854248 C102.82913463 76.78061241 98.58236923 76.83701447 94.31860352 76.82739258 C92.87732841 76.82882767 92.87732841 76.82882767 91.40693665 76.83029175 C89.37903782 76.83096887 87.35113678 76.82914737 85.32324219 76.82495117 C82.2910445 76.81966148 79.25899939 76.82487835 76.22680664 76.83129883 C70.33588935 76.83550358 64.44717304 76.77530128 58.55688477 76.69458008 C57.11034515 76.68267639 57.11034515 76.68267639 55.63458252 76.67053223 C52.86388449 76.64007401 50.09620018 76.57510761 47.32641602 76.49926758 C46.49744308 76.49404083 45.66847015 76.48881409 44.81437683 76.48342896 C41.08886687 76.34526325 39.0596877 76.1830188 36.335495 73.53665161 C34.2472647 70.19983291 34.08936542 68.42118674 34.16625977 64.51879883 C34.17915039 63.36186523 34.19204102 62.20493164 34.20532227 61.01293945 C34.23883789 59.81475586 34.27235352 58.61657227 34.30688477 57.38208008 C34.32493164 56.16456055 34.34297852 54.94704102 34.36157227 53.69262695 C34.40863346 50.69247586 34.47437167 47.69393119 34.55688477 44.69458008 C33.76397034 44.70346252 32.97105591 44.71234497 32.15411377 44.72149658 C24.67959293 44.80166342 17.20528069 44.86255469 9.73044205 44.90182877 C5.88757225 44.92269891 2.04505784 44.95100514 -1.79760742 44.99633789 C-5.50642639 45.03981753 -9.21490365 45.0637215 -12.92395782 45.07408905 C-14.33857859 45.08147675 -15.75318076 45.09590351 -17.16765594 45.11750031 C-19.14958946 45.14655623 -21.13186723 45.14821416 -23.11401367 45.14868164 C-24.24208435 45.15756409 -25.37015503 45.16644653 -26.53240967 45.17559814 C-30.12121698 44.58251818 -31.29010224 43.58285838 -33.44311523 40.69458008 C-33.94311523 37.13208008 -33.94311523 37.13208008 -33.44311523 33.69458008 C-31.08174493 31.17305396 -29.63239671 30.71706584 -26.1796875 30.30690002 C-24.23920532 30.29879555 -24.23920532 30.29879555 -22.25952148 30.29052734 C-21.54359833 30.28366409 -20.82767517 30.27680084 -20.09005737 30.26972961 C-17.72837378 30.2514585 -15.3673542 30.25529889 -13.00561523 30.26098633 C-11.36181421 30.25642502 -9.71801509 30.2511196 -8.07421875 30.24510193 C-4.63102464 30.23617053 -1.18806248 30.23859462 2.25512695 30.24853516 C6.66718689 30.26003178 11.07844732 30.23980349 15.49040222 30.21061802 C18.88420697 30.1922721 22.27781949 30.1925451 25.67166138 30.19825554 C27.29836144 30.19840892 28.92507439 30.19235101 30.55172729 30.17996407 C32.82609245 30.16508343 35.09897233 30.17570709 37.37329102 30.19287109 C39.31377319 30.19312035 39.31377319 30.19312035 41.29345703 30.19337463 C45.10397463 30.77860352 46.30039621 31.62012859 48.55688477 34.69458008 C49.01098633 37.62719727 49.01098633 37.62719727 48.94750977 40.99145508 C48.93751953 42.0778125 48.9275293 43.16416992 48.91723633 44.28344727 C48.88082031 45.65662109 48.8444043 47.02979492 48.80688477 48.44458008 C48.72438477 52.81708008 48.64188477 57.18958008 48.55688477 61.69458008 C64.72688477 61.69458008 80.89688477 61.69458008 97.55688477 61.69458008 C95.33669089 54.030492 95.33669089 54.030492 92.55688477 46.69458008 C91.30391602 46.68040039 90.05094727 46.6662207 88.76000977 46.65161133 C87.10893149 46.6047057 85.45789095 46.55645833 83.80688477 46.50708008 C82.98188477 46.5012793 82.15688477 46.49547852 81.30688477 46.48950195 C80.50766602 46.46049805 79.70844727 46.43149414 78.88500977 46.40161133 C78.15185547 46.38590088 77.41870117 46.37019043 76.66333008 46.35400391 C73.49931586 45.36350757 72.46508492 43.35649662 70.55688477 40.69458008 C69.18481445 37.83203125 69.18481445 37.83203125 67.97875977 34.73754883 C67.54047852 33.62573242 67.10219727 32.51391602 66.65063477 31.3684082 C66.20719727 30.21791992 65.76375977 29.06743164 65.30688477 27.88208008 C64.84797852 26.71225586 64.38907227 25.54243164 63.91625977 24.3371582 C62.78859568 21.4592655 61.6691253 18.57846089 60.55688477 15.69458008 C59.72638611 15.68871384 58.89588745 15.6828476 58.04022217 15.67680359 C50.21228954 15.61889201 42.38464272 15.54682428 34.55698776 15.45886517 C30.53272251 15.4141437 26.5085589 15.3748917 22.48413086 15.34814453 C18.60007243 15.32212895 14.71640479 15.28173949 10.8325882 15.23139381 C9.35108553 15.21471317 7.86951525 15.20320633 6.38793182 15.19696617 C4.31199713 15.18733763 2.23706486 15.15929611 0.16137695 15.12695312 C-1.0199884 15.11585007 -2.20135376 15.10474701 -3.41851807 15.0933075 C-6.72448598 14.65748746 -8.10659249 14.0352738 -10.44311523 11.69458008 C-11.44311523 8.81958008 -11.44311523 8.81958008 -11.44311523 5.69458008 C-8.47258296 0.56196928 -5.59922991 -0.04339643 0 0 Z " fill="currentColor" transform="translate(11.5,23.5) scale(0.1)"/>
          </svg>
          <div className="logo-text">
            <span className="logo-principal">PeruGo</span>
            <span className="logo-secundario">El Perú te habla</span>
          </div>
        </Link>

        {/* NAVEGACIÓN PRINCIPAL */}
        <nav className="nav-header" aria-label="Navegación principal">
          
          {/* 1. Botón EXPLORAR (Brújula) */}
          <button
            className={`btn-icono ${isActive("/explorar") ? "activo" : ""}`}
            title="Explorar Destinos"
          >
            <svg width="22px" height="22px" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <circle cx="12" cy="12" r="10"/>
              <polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/>
            </svg>
          </button>

          {/* 3. Micrófono */}
          <button
            className={`btn-icono mic-btn ${record ? "mic-active" : ""}`}
            title="Hablar con el asistente"
            onClick={toggleRecord}
          >
             <svg width="22px" height="22px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 10V12C19 15.866 15.866 19 12 19M5 10V12C5 15.866 8.13401 19 12 19M12 19V22M8 22H16M12 15C10.3431 15 9 13.6569 9 12V5C9 3.34315 10.3431 2 12 2C13.6569 2 15 3.34315 15 5V12C15 13.6569 13.6569 15 12 15Z" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
            </svg>
          </button>

          {/* 4. Modo Oscuro */}
          <button className="btn-icono" title="Cambiar modo" onClick={toggleMode}>
            {isDarkMode ? (
              <svg width="22px" height="22px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fillRule="evenodd" clipRule="evenodd" d="M3.39703 11.6315C3.39703 16.602 7.42647 20.6315 12.397 20.6315C15.6858 20.6315 18.5656 18.8664 20.1358 16.23C16.7285 17.3289 12.6922 16.7548 9.98282 14.0455C7.25201 11.3146 6.72603 7.28415 7.86703 3.89293C5.20697 5.47927 3.39703 8.38932 3.39703 11.6315ZM21.187 13.5851C22.0125 13.1021 23.255 13.6488 23 14.5706C21.7144 19.2187 17.4543 22.6315 12.397 22.6315C6.3219 22.6315 1.39703 17.7066 1.39703 11.6315C1.39703 6.58874 4.93533 2.25845 9.61528 0.999986C10.5393 0.751502 11.0645 1.99378 10.5641 2.80935C8.70026 5.84656 8.83194 10.0661 11.397 12.6312C13.9319 15.1662 18.1365 15.3702 21.187 13.5851Z" fill="#ffffff"/>
              </svg>
            ) : (
              <svg width="22px" height="22px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="5" stroke="currentColor" strokeWidth="2"/>
                <path d="M12 2V4M12 20V22M4 12L2 12M22 12L20 12M19.7778 4.22266L17.5558 6.25424M4.22217 4.22266L6.44418 6.25424M6.44434 17.5557L4.22211 19.7779M19.7778 19.7773L17.5558 17.5551" stroke="currentColor" strokeWidth="2" strokeLinecap="round"/>
              </svg>
            )}
          </button>

          {/* 5. Autenticación / Perfil */}
          {!effectiveLogged ? (
            <div className="auth-buttons-desktop">
              <Link href="/login">
                <button className="btn-iniciar-sesion">Iniciar sesión</button>
              </Link>
              <Link href="/register">
                <button className="btn-iniciar-sesion" style={{ marginLeft: "6px" }}>Registrarse</button>
              </Link>
            </div>
          ) : (
            <div className="profile-wrapper" ref={menuRef}>
              <button
                className="btn-icono"
                title="Perfil"
                onClick={() => setMenuOpen((s) => !s)}
              >
                <svg width="22px" height="22px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M5 21C5 17.134 8.13401 14 12 14C15.866 14 19 17.134 19 21M16 7C16 9.20914 14.2091 11 12 11C9.79086 11 8 9.20914 8 7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7Z" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                </svg>
              </button>

              {menuOpen && (
                <div className="profile-menu">
                  <div className="profile-info">
                    <div className="profile-name">{userData.nombre}</div>
                    <div className="profile-email">{userData.correo}</div>
                  </div>
                  <div className="profile-actions">
                    <Link href="/mis-planes" onClick={() => setMenuOpen(false)}>
                      <button className="btn-opcion">Mis Planes</button>
                    </Link>
                    <button className="btn-opcion-cerrar" onClick={handleLogout}>
                      Cerrar sesión
                    </button>
                  </div>
                </div>
              )}
            </div>
          )}

          {/* Menú Móvil Hamburguesa */}
          <button 
            className="menu-movil-btn" 
            onClick={() => setMenuMovilAbierto(!menuMovilAbierto)}
          >
            ☰
          </button>
        </nav>
      </div>

      {/* PANEL MÓVIL */}
      <div className={`menu-movil-panel ${menuMovilAbierto ? "active" : ""}`}>
        {!effectiveLogged && (
          <>
            <Link href="/login" onClick={() => setMenuMovilAbierto(false)}>
              <button className="btn-iniciar-sesion">Iniciar sesión</button>
            </Link>
            <Link href="/register" onClick={() => setMenuMovilAbierto(false)}>
              <button className="btn-iniciar-sesion">Registrarse</button>
            </Link>
          </>
        )}
        <Link href="/explorar" onClick={() => setMenuMovilAbierto(false)}>
            <button className="btn-opcion">Explorar Destinos</button>
        </Link>
        <Link href="/mis-planes" onClick={() => setMenuMovilAbierto(false)}>
            <button className="btn-opcion">Mis Planes</button>
        </Link>
      </div>
    </header>
  );
}

